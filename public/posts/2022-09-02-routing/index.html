<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="https://victorponz.github.io/symfony-teoria/css/styles.css" />
  <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.0.13/css/all.css' integrity='sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp' crossorigin='anonymous'>
  <link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />
  <link rel="stylesheet" href="https://victorponz.github.io/symfony-teoria/css/style.css" />
  <link rel="stylesheet" href="https://victorponz.github.io/symfony-teoria//css/utilities.css" />
  <link rel="stylesheet" href="https://victorponz.github.io/symfony-teoria//css/post.css" />
  
  
  <title>Programación en JAVA | Routing</title>
  <script>
      document.documentElement.setAttribute("data-theme", localStorage.getItem("theme") ?  localStorage.getItem("theme") : "");
    </script>
</head>
<body><header id="hero">
    
    <nav class="navbar">
      <div class="container">
        
        <h1 id="logo">
        </h1>
        
        <ul class="nav-menu">
          <li><a class="nav-link  btn btn-primary" href="/">HOME</a></li>
          <li>
            <a
              class="nav-link btn btn-primary"
              href="https://github.com/victorponz/symfony-teoria"
              >GitHub <i class="fas fa-arrow-right"></i
            ></a>
          </li>
          
          <div class="theme-switch">
            <input type="checkbox" id="switch" />
            <label class="toggle-icons" for="switch">
              <img class="moon" src="https://victorponz.github.io/symfony-teoria//img/moon.svg" />
              <img class="sun" src="https://victorponz.github.io/symfony-teoria//img/sun.svg" />
            </label>
          </div>
          
        </ul>
        <div class="hamburger">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
      </div>
    </nav>
  </header>
<div id="content">
          <div id="write-wrapper">
            <section id="projects" class="project-container container">
              <div id="subject-container" style="width: 100%; padding-top:80px; min-height:800px">
                 <div class="subject-details">
                  <div id="write">
                    <div style="height: 80px; border-left: 5px solid var(--text-color)"></div>
                    <h1 class="indice">Routing</h1>
                  <div id='content'><p>A partir de ahora, vamos a usar anotaciones para definir las rutas. De esta forma es más sencillo ya que las tenemos definidas en el propio código <code>php</code></p>
<p>Para ello, ve a la carpeta del proyecto y escribe este comando</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">composer require annotations
</code></pre></div><p>En cualquier momento, podemos conocer qué rutas están definidas mediante el siguiente comando:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">php bin/console debug:router
</code></pre></div><p>La salida será parecida a esta:
<img src="/symfony-teoria/assets/img/r1.png" alt=""></p>
<p>A partir de ahora ya no usaremos el archivo <code>config/routes.yaml</code>, sino que las definimos en el propio controlador.</p>
<p>Vamos a ver un ejemplo de una ruta definida con anotaciones.</p>
<p>Primero eliminad las rutas <code>blog_list</code> y <code>blog_show</code> de <code>config/routes.yaml</code> porque las definiremos con una anotación.</p>
<p><code>&gt;&gt; src/Controller/BlogControllerAnnotation.php</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">namespace</span> <span style="color:#a6e22e">App\Controller</span>;

<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\Routing\Annotation\Route</span>;

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlogControllerAnnotation</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">AbstractController</span>{
    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">    * @Route(&#34;/blogAnnotation&#34;, name=&#34;blog_list&#34;)
</span><span style="color:#e6db74">    */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">list</span>()
    {
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    }

    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">    * @Route(&#34;/blogAnnotation/{entryName}&#34;, name=&#34;blog_show&#34;)
</span><span style="color:#e6db74">    */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">show</span>($entryName)
    {
        <span style="color:#75715e">// $entryName will equal the dynamic part of the URL
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// e.g. at /blog/yay-routing, then $entryName=&#39;yay-routing&#39;
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    }
}
</code></pre></div><h2 id="uso-de-requisitos-en-comodines">Uso de requisitos en {comodines}</h2>
<p>Imagina que la ruta de <code>blog_list</code> contiene una lista paginada de publicaciones de blog, con URL como <code>/blog/2</code> y <code>/blog/3</code> para las páginas 2 y 3. Si cambiamos la ruta a <code>/blog/{page}</code>, tendremos un problema:</p>
<pre><code>blog_list: /blog/{page} coincidirá con /blog/*;
blog_show: /blog/{entryName} también coincidirá con /blog/ *.
</code></pre><p>Cuando dos rutas coinciden con la misma URL, la primera ruta que se carga gana. Desafortunadamente, eso significa que <code>/blog/yay-routing</code> coincidirá con la ruta <code>blog_list</code>. ¡No es bueno!</p>
<p>Para solucionar esto, agrega un requisito para que el comodín {page} solo pueda coincidir con números (dígitos):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">namespace</span> <span style="color:#a6e22e">App\Controller</span>;

<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\HttpFoundation\Response</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\Routing\Annotation\Route</span>;

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlogController</span>
{
    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">    * @Route(&#34;/blog/{page}&#34;, name=&#34;blog_list&#34;, requirements={&#34;page&#34;=&#34;\d+&#34;})
</span><span style="color:#e6db74">    */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">list</span>($page)
    {
      $content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;ul&gt;&#34;</span>;
      <span style="color:#66d9ef">for</span>($i <span style="color:#f92672">=</span> $page <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>; $i <span style="color:#f92672">&lt;=</span> ($page <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>; $i<span style="color:#f92672">++</span>){
        $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;&lt;li&gt;Entrada </span><span style="color:#e6db74">$i</span><span style="color:#e6db74"> &lt;/li&gt;&#34;</span>;
      }
      $content <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34;&lt;/ul&gt;&#34;</span>;
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Response</span>(
            <span style="color:#e6db74">&#34;&lt;html&gt;&lt;body&gt;</span><span style="color:#e6db74">$content</span><span style="color:#e6db74">&lt;/body&gt;&lt;/html&gt;&#34;</span>
        );
    }

    <span style="color:#e6db74">/**
</span><span style="color:#e6db74">    * @Route(&#34;/blog/{entryName}&#34;, name=&#34;blog_show&#34;)
</span><span style="color:#e6db74">    */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">show</span>($entryName)
    {

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Response</span>(
            <span style="color:#e6db74">&#39;&lt;html&gt;&lt;body&gt;Entrada &#39;</span> <span style="color:#f92672">.</span> $entryName <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span>
        );
    }
}
</code></pre></div><p>El <code>\d+</code> es una expresión regular que coincide con un dígito de cualquier longitud. Ahora:</p>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">Ruta</th>
<th align="left">Parámetros</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">/blog/2</td>
<td align="left">blog_list</td>
<td align="left">$page = 2</td>
</tr>
<tr>
<td align="left">/blog/nombre-de-entrada</td>
<td align="left">blog_show</td>
<td align="left">$entryName = nombre-de-entrada</td>
</tr>
</tbody>
</table>
<h2 id="valores-por-defecto-en-comodines">Valores por defecto en {comodines}</h2>
<p>En el ejemplo anterior, <code>blog_list</code> tiene una ruta a <code>/blog/{page}</code>. Si el usuario visita <code>/blog/1</code>, coincidirá. Pero si visita <code>/blog</code>, no coincidirá. Tan pronto como agregamos un <code>{comodín}</code> a una ruta, debe tener un valor.</p>
<p>Entonces, ¿cómo puedes hacer que <code>blog_list</code> coincida cuando el usuario visita <code>/blog</code>? La respuesta es, <strong>agregando un valor predeterminado</strong>:
Se puede hacer de dos formas:
<strong>1</strong> Mediante anotaciones</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">class BlogController extends AbstractController{
    /**
    * @Route(&#34;/blog/{page}&#34;, name=&#34;blog_list&#34;, requirements={&#34;page&#34;=&#34;\d+&#34;}, defaults={&#34;page&#34;=1})
    */
    public function list($page)
    {
        // ...
    }
}
</code></pre></div><p><strong>2</strong> Mediante parámetros <code>php</code> por defecto</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">class BlogController extends AbstractController{
    /**
    * @Route(&#34;/blog/{page}&#34;, name=&#34;blog_list&#34;, requirements={&#34;page&#34;=&#34;\d+&#34;})
    */
    public function list($page = 1)
    {
        // ...
    }
}
</code></pre></div><p>Ahora, cuando el usuario visita <code>/blog</code>, la ruta de <code>blog_list</code> coincidirá y <strong>$page</strong> tendrá un valor predeterminado de <strong>1</strong>.</p>
<h2 id="ignorar-parámetros-en-la-ruta">Ignorar parámetros en la ruta</h2>
<p>No hace falta que todos los parámetros recogidos en la ruta, sean tratados en el controlador. Por ejemplo, en el siguiente controlador no nos interesa procesar el  parámetro <code>{entryName}</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">    /**
    * @Route(&#34;/blog/{entryName}/{entryId}&#34;, name=&#34;blog_show_by_id&#34;)
    */
    public function showById($entryId)
    {

        return new Response(
            &#39;&lt;<span style="color:#f92672">html</span>&gt;&lt;<span style="color:#f92672">body</span>&gt;Entrada &#39; . $entryId . &#39;&lt;/<span style="color:#f92672">body</span>&gt;&lt;/<span style="color:#f92672">html</span>&gt;&#39;
        );
    }
</code></pre></div><p>Esto viene muy bien cuando estamos creando url para los buscadores.</p>
<h2 id="añadir-requerimientos-en-el-método-http">Añadir requerimientos en el método HTTP</h2>
<p>Además de la <code>URL</code>, también puedes hacer coincidir el método de la solicitud entrante (es decir, <code>GET</code>, <code>HEAD</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>). Supongamos que creas una API para tu tienda y tiene 2 rutas: una para mostrar un producto (en una solicitud <code>GET</code> o <code>HEAD</code>) y otra para actualizar un producto (en una solicitud <code>PUT</code> o <code>POST</code>). Esto se puede lograr con la siguiente configuración de ruta:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">class ProductApiController extends AbstractController{
    /**
    * @Route(&#34;/api/productos/{id}&#34;, methods={&#34;GET&#34;,&#34;HEAD&#34;})
    */
    public function show($id)
    {
        // ... devolver una respuesta json con el producto
    }
    
    /**
    * @Route(&#34;/api/productos/{id}&#34;, methods={&#34;PUT&#34;, &#34;POST&#34;})
    */
    public function edit($id)
    {
        // ... editar un producto
    }
}
</code></pre></div><p>A pesar de que estas dos rutas son idénticas (<code>/api/productos/{id}</code>), la primera ruta solo hará coincidir las solicitudes <code>GET</code> o <code>HEAD</code> y la segunda ruta solo hará coincidir las solicitudes <code>PUT</code> o <code>POST</code>. Esto significa que puedes visualizar y editar el producto con la misma URL, mientras uses controladores distintos para las dos acciones.</p>
<p>También se puede usar otro tipo de requerimientos, como por ejemplo:</p>
<ul>
<li><strong>User Agent</strong>. Por ejemplo, para que coincida con Firefox</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># config/routes.yaml</span>
<span style="color:#66d9ef">contact</span>:
    <span style="color:#66d9ef">path</span>:       /contact
    <span style="color:#66d9ef">controller</span>: <span style="color:#e6db74">&#39;App\Controller\DefaultController::contact&#39;</span>
    <span style="color:#66d9ef">condition</span>:  <span style="color:#e6db74">&#34;context.getMethod() in [&#39;GET&#39;, &#39;HEAD&#39;] and request.headers.get(&#39;User-Agent&#39;) matches &#39;/firefox/i&#39;&#34;</span>
</code></pre></div><ul>
<li><strong>HOST</strong>. Por ejemplo, para servir una página distinta dependiendo del host</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Controller/MainController.php
namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\Routing\Annotation\Route;

class MainController extends AbstractController
{
    /**
     * @Route(&#34;/&#34;, name=&#34;mobile_homepage&#34;, host=&#34;m.example.com&#34;)
     */
    public function mobileHomepage()
    {
        // ...
    }

    /**
     * @Route(&#34;/&#34;, name=&#34;homepage&#34;)
     */
    public function homepage()
    {
        // ...
    }
}
</code></pre></div><h2 id="generar-urls">Generar url&rsquo;s</h2>
<p>Para generar una url a partir del nombre y parámetros de una ruta:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"> $url = $this-&gt;generateUrl(&#39;blog_show&#39;, [&#39;entryId&#39; =&gt; $entryId]);
</code></pre></div><p>Por ejemplo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">use Symfony\Component\Routing\Generator\UrlGeneratorInterface;
    // ...
class BlogController  extends AbstractController
{
    // ...
    /**
    * @Route(&#34;/blog/{entryId}&#34;, name=&#34;blog_show&#34;)
    */
    public function show($entryId)
    {
      $url = $this-&gt;generateUrl(
      &#39;blog_show&#39;,
      [&#39;entryId&#39; =&gt; $entryId]
      );
        return new Response(
            &#39;&lt;<span style="color:#f92672">html</span>&gt;&lt;<span style="color:#f92672">body</span>&gt;Entrada &#39; . $entryId . &#39; url &#39; . $url . &#39;&lt;/<span style="color:#f92672">body</span>&gt;&lt;/<span style="color:#f92672">html</span>&gt;&#39;
        );
    }
</code></pre></div><h2 id="generar-urls-con-query-strings">Generar url&rsquo;s con <code>query strings</code></h2>
<p>El método <code>generateUrl()</code> toma una matriz de valores <code>{comodín}</code> para generar el URI. Pero si pasas más, se agregarán al URI como una cadena de consulta:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$url = $this-&gt;generateUrl(&#39;blog_list&#39;, [
    &#39;page&#39; =&gt; 2,
    &#39;category&#39; =&gt; &#39;Symfony&#39;,
]);
// 
</code></pre></div><p>Dará como resultado:</p>
<pre><code>/blog/2?category=Symfony
</code></pre><p>Fijáos en <code>?</code> en el querystring!</p>
<h2 id="generar-urlss-absolutas">Generar urls&rsquo;s absolutas</h2>
<p>De forma predeterminada, el enrutador generará URL relativas (por ejemplo, <code>/blog</code>). Si pasamos el parámetro <code>UrlGeneratorInterface::ABSOLUTE_URL</code> al tercer argumento del método <code>generateUrl()</code> generará una url absoluta:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">use Symfony\Component\Routing\Generator\UrlGeneratorInterface;
// ...
class BlogController extends AbstractController
{
    // ...
    $url = $this-&gt;generateUrl(&#39;blog_list&#39;, array(
          &#39;page&#39; =&gt; 2,
          &#39;category&#39; =&gt; &#39;Symfony&#39;,
        ), UrlGeneratorInterface::ABSOLUTE_URL);
     
}
</code></pre></div><p>Generará</p>
<pre><code>http://127.0.0.1:8000/blog/2?category=Symfony  
</code></pre><h2 id="mostrar-una-página-estática-no-asociada-a-un-controlador">Mostrar una página estática no asociada a un controlador</h2>
<p>Por lo general, cuando necesitamos crear una página, necesitamos crear un controlador y representar una plantilla desde ese controlador. Pero si estamos renderizando una plantilla simple que no necesita datos, podemos evitar crear el controlador por completo, utilizando el controlador integrado <code>Symfony\Bundle\FrameworkBundle\Controller\TemplateController::templateAction</code></p>
<p>Por ejemplo, supongamos que deseamos representar una plantilla <code>static/privacy.html.twig</code>, que no requiere que se le pasen variables. Podemos hacer esto sin crear un controlador, editando, esta vez sí, el archivo <code>config/routes.yaml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># config/routes.yaml</span>
<span style="color:#66d9ef">acme_privacy</span>:
    <span style="color:#66d9ef">path</span>:         /privacy
    <span style="color:#66d9ef">controller</span>:   Symfony\Bundle\FrameworkBundle\Controller\TemplateController::templateAction
    <span style="color:#66d9ef">defaults</span>:
        <span style="color:#66d9ef">template</span>: static/privacy.html.twig
</code></pre></div><p>La plantilla hemos de guardarla en el directorio <code>/templates/static/</code></p>

                  </div>
                 </div>
                </div>
              </div>
            </section><footer id="footer">
    <div class="container">
      
      <div class="attribution">
        <a rel="license" href="http://creativecoms.org/licenses/by-sa/4.0/">
          <img alt="Licencia de Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
        </a>
        <br />Todo el material de esta web está bajo una <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">licencia de Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional</a>.

      </div>
      <div class="attribution">
        <a
          href="https://github.com/CommunityPro/portfolio-html"
          target="_blank"
          rel="noopener noreferrer"
        >
          <img
            src="https://user-images.githubusercontent.com/62628408/157202263-9174da24-b19a-4017-9b7c-a1d26ae8f014.svg"
            alt="attribution"
            width="150px"
          />
        </a>
      </div>
    </div>
  </footer>
  <script src="https://victorponz.github.io/symfony-teoria/js/script.js"></script></body>
</html>
